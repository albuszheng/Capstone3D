
<!DOCTYPE html>
<html>
<head>
    <title>three.js</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            margin: 0px;
            overflow: hidden;
        }

    </style>
</head>
<body>
<div id="container"></div>
<script src="js/three.js"></script>
<script src="js/ColladaLoader.js"></script>
<script src="js/Detector.js"></script>
<script src="js/TrackballControls.js"></script>

<script>

    if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

    var container;
    var camera, controls, scene, renderer;
    var plane, cube;
    var manager;
    var cubeGeo, cubeMaterial;

    var objects = [];

    init();
    animate();

    function init() {
        container = document.getElementById('container');

        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 1000 );
        camera.position.set( -5, -20, 30 );
        camera.lookAt( new THREE.Vector3() );

        controls = new THREE.TrackballControls( camera );

        controls.rotateSpeed = 1.0;
        controls.zoomSpeed = 1.2;
        controls.panSpeed = 0.8;

        controls.noZoom = false;
        controls.noPan = false;

        controls.staticMoving = true;
        controls.dynamicDampingFactor = 0.3;

        controls.keys = [ 0, 0, 0 ];

        controls.addEventListener( 'change', render );

        scene = new THREE.Scene();

        // grid
        var size = 10, step = 1;

        var geometry = new THREE.Geometry();

        for ( var i = - size; i <= size; i += step ) {
            geometry.vertices.push( new THREE.Vector3( - size, i, 0) );
            geometry.vertices.push( new THREE.Vector3(   size, i, 0 ) );

            geometry.vertices.push( new THREE.Vector3( i, - size, 0 ) );
            geometry.vertices.push( new THREE.Vector3( i,   size, 0 ) );

        }

        var material = new THREE.LineBasicMaterial( { color: 0x000000, opacity: 0.2, transparent: false } );

        var line = new THREE.LineSegments( geometry, material );
        scene.add( line );

        // plane
        var geometry = new THREE.PlaneBufferGeometry( 20, 20, 0 );

        plane = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { visible: true } ) );
        scene.add( plane );

        objects.push( plane );

        // Lights
        var ambientLight = new THREE.AmbientLight( 0x606060 );
        scene.add( ambientLight );

        var directionalLight = new THREE.DirectionalLight( 0xffffff );
        directionalLight.position.set( 1, 0.75, 0.5 ).normalize();
        scene.add( directionalLight );


        // model
        manager = new THREE.LoadingManager();
        manager.onProgress = function ( item, loaded, total ) {
            console.log(( loaded / total * 100) + '% loaded');
        };

        loadModel('furniture/bed1.dae', new THREE.Vector3(7, 9, 0), -Math.PI/2);
        loadModel('furniture/bed1.dae', new THREE.Vector3(-9.5, 9, 0), -Math.PI/2);
        loadModel('furniture/window1.dae', new THREE.Vector3(-6.5, 9.5, 2), 0);
        loadModel('furniture/window2.dae', new THREE.Vector3(6, 9.5, 2), 0);
        loadModel('furniture/drawer.dae', new THREE.Vector3(5.5, 8.5, 0), 0);
        loadModel('furniture/drawer.dae', new THREE.Vector3(-7, 8.5, 0), 0);
        loadModel('furniture/door1_closed.dae', new THREE.Vector3(-4, 3, 0), Math.PI/2);
        loadModel('furniture/door1_open.dae', new THREE.Vector3(4, 3, 0), Math.PI/2);
        loadModel('furniture/sofa1_2.dae', new THREE.Vector3(7, -8, 0), Math.PI);
        loadModel('furniture/TV1.dae', new THREE.Vector3(5, -5, 0), 0);
        loadModel('furniture/TV1.dae', new THREE.Vector3(9, 3, 0), Math.PI);
        loadModel('furniture/table1.dae', new THREE.Vector3(-7, -7, 0), 0);

        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setClearColor( 0xf0f0f0 );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.sortObjects = false;
        container.appendChild( renderer.domElement );

        window.addEventListener( 'resize', onWindowResize, false );

        render();
    }

    function loadModel(path, pos, rotation) {
        var loader = new THREE.ColladaLoader(manager);

        loader.load(
                path,
                function ( collada ) {
                    var voxel = collada.scene;
                    voxel.rotateZ(rotation);
                    voxel.position.copy(pos);
                    scene.add( voxel );
                    objects.push( voxel );
                }
        );
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

        controls.handleResize();
        render();

    }

    function animate() {
        requestAnimationFrame( animate );
        renderer.render( scene, camera );
        controls.update();
    }

    function render() {
        renderer.render( scene, camera );
    }

</script>

</body>
</html>
